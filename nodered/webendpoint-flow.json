[{"id":"91e6e10.e4f2ea","type":"tab","label":"WebEndpoint","disabled":false,"info":""},{"id":"c6a1993.99c9b68","type":"http in","z":"91e6e10.e4f2ea","name":"GET Emergency","url":"/api/rooms/emergency/:idTenant/:idResidence","method":"get","upload":false,"swaggerDoc":"","x":160,"y":360,"wires":[["b323ccac.807a5"]]},{"id":"b323ccac.807a5","type":"function","z":"91e6e10.e4f2ea","name":"retrieveData","func":"var dataObject = {};\ndataObject[\"idTenant\"] = msg.req.params.idTenant;\ndataObject[\"idResidence\"] = msg.req.params.idResidence;\nmsg.payload = dataObject\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":300,"wires":[["1038e44d.9883fc"]]},{"id":"1038e44d.9883fc","type":"function","z":"91e6e10.e4f2ea","name":"DataToMsg","func":"msg.idResidence = msg.payload.idResidence;\nmsg.idTenant = msg.payload.idTenant;\nmsg.influxLine = \"q=SELECT%20*%20FROM%20alarm%20WHERE%20idTenant=#idTenant%20AND%20idResidence=#idResidence\"\nmsg.influxLine = msg.influxLine.replace('#idTenant',msg.payload.idTenant);\nmsg.influxLine = msg.influxLine.replace('#idResidence',msg.payload.idResidence);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":300,"wires":[["576952b3.214cdc"]]},{"id":"576952b3.214cdc","type":"function","z":"91e6e10.e4f2ea","name":"Prepare GET URL","func":"var getUrl = \"http://#influxIp:8086/query?db=#db\";\ngetUrl =  getUrl.replace('#influxIp', env.get(\"INFLUX_IP\"));\ngetUrl =  getUrl.replace('#db', env.get(\"SENSOR_DATABASE_NAME\"));\nmsg.url = getUrl+\"&\"+msg.influxLine;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":320,"wires":[["c6bcd04a.eba73"]]},{"id":"c6bcd04a.eba73","type":"http request","z":"91e6e10.e4f2ea","name":"GET to influx","method":"GET","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":340,"wires":[["48fbf14a.fc6c8"]]},{"id":"48fbf14a.fc6c8","type":"http response","z":"91e6e10.e4f2ea","name":"Response","statusCode":"","headers":{},"x":1460,"y":320,"wires":[]},{"id":"bebc5175.a3688","type":"http in","z":"91e6e10.e4f2ea","name":"GET Room Data","url":"/api/rooms/:idTenant/:idResidence","method":"get","upload":false,"swaggerDoc":"","x":160,"y":600,"wires":[["123e4cf6.c7b843"]]},{"id":"123e4cf6.c7b843","type":"function","z":"91e6e10.e4f2ea","name":"retrieveData","func":"var dataObject = {};\ndataObject[\"idTenant\"] = msg.req.params.idTenant;\ndataObject[\"idResidence\"] = msg.req.params.idResidence;\nmsg.payload = dataObject\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":540,"wires":[["b3fa1a3f.3ca9d8"]]},{"id":"b3fa1a3f.3ca9d8","type":"function","z":"91e6e10.e4f2ea","name":"DataToMsg","func":"msg.idResidence = msg.payload.idResidence;\nmsg.idTenant = msg.payload.idTenant;\nmsg.influxLine = \"q=SELECT%20*%20FROM%20presence,%20airQuality,%20humidity,%20temperature,%20light%20WHERE%20idTenant=#idTenant%20AND%20idResidence=#idResidence\"\nmsg.influxLine = msg.influxLine.replace('#idTenant',msg.payload.idTenant);\nmsg.influxLine = msg.influxLine.replace('#idResidence',msg.payload.idResidence);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":540,"wires":[["e2aa2e86.f9a6d"]]},{"id":"e2aa2e86.f9a6d","type":"function","z":"91e6e10.e4f2ea","name":"Prepare GET URL","func":"var getUrl = \"http://#influxIp:8086/query?db=#db\";\ngetUrl =  getUrl.replace('#influxIp', env.get(\"INFLUX_IP\"));\ngetUrl =  getUrl.replace('#db', env.get(\"SENSOR_DATABASE_NAME\"));\nmsg.url = getUrl+\"&\"+msg.influxLine;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":560,"wires":[["aaa3.a16c655d6"]]},{"id":"aaa3.a16c655d6","type":"http request","z":"91e6e10.e4f2ea","name":"GET to influx","method":"GET","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":580,"wires":[["d466226d.c5481"]]},{"id":"d466226d.c5481","type":"http response","z":"91e6e10.e4f2ea","name":"Response","statusCode":"","headers":{},"x":1460,"y":560,"wires":[]}]